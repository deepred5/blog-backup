---
title: 前端支付流程小结
date: 2020-06-08 10:32:08
tags:
---



### pc端

微信

pc端一般只能使用扫一扫二维码进行支付(native支付)

https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_1



```
// 模式二
// 下单，传入paynum即可，然后ajax轮训结果，成功跳转至结果页


weixin://wxpay/bizpayurl?pr=UBE1ZgF
```



支付宝(花呗分期)

https://opendocs.alipay.com/open/270/105898

```
// 扫码
// https://opendocs.alipay.com/open/194/106078

https://qr.alipay.com/bax06893swswc4inaknv505d

// 跳转新页面
https://mapi.alipay.com/gateway.do?_input_charset=UTF-8&body=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&disable_paymethod=pcreditpayInstallment&it_b_pay=4038m&notify_url=https%3A%2F%2Fpaynotice.hujiang.com%2Fv1%2Fnotify%2Fali%2Fpay%2Fweb&out_trade_no=20200608183138315194&partner=2088521191999411&payment_type=1&return_url=https%3A%2F%2Fpay.hujiang.com%2Fcashier%2Fsuccess%2F21031001000020200608135006307416&seller_email=xjpay%40hujiang.com&seller_id=2088521191999411&service=create_direct_pay_by_user&sign=7743d4023ab80ffddd6b85733815c030&sign_type=MD5&subject=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&total_fee=1718.00

// 重定向
https://excashier.alipay.com/standard/auth.htm?payOrderId=6aedbe62bed449019d95d727584fe40b.20
```

![image-20200608183322914](/Users/hj/Library/Application Support/typora-user-images/image-20200608183322914.png)

b站二维码同时支持微信，qq, 支付宝（原理看代码）

```
https://pay.bilibili.com/payplatform-h5/qrpay.html?codeType=0&domain=pay.bilibili.com&payToken=GR0eu9f%2BUASaM6NfgHVqordUbxOV1MuQQJTjkzTmTqqfPP1yZ%2FuUQ96aA%3D%3D

https://pay.bilibili.com/payplatform-h5/pccashier.html?params=%7B%22createIp%22%3A%22218.82.143.186%22%2C%22customerId%22%3A10001%2C%22defaultChoose%22%3A%22wechat%22%2C%22deviceType%22%3A1%2C%22extData%22%3A%22%7B%5C%22profitSharing%5C%22%3A%5C%22jzbPs%5C%22%2C%5C%22psExt%5C%22%3A%5C%22%7B%5C%5C%5C%22optType%5C%5C%5C%22%3A%5C%5C%5C%22jzbps_self%5C%5C%5C%22%7D%5C%22%7D%22%2C%22feeType%22%3A%22CNY%22%2C%22notifyUrl%22%3A%22http%3A%2F%2Fshow.bilibili.co%2Fapi%2Fticket%2Forder%2FpayNotify%22%2C%22orderCreateTime%22%3A%221591600424000%22%2C%22orderExpire%22%3A%22600%22%2C%22orderId%22%3A%224008483054601999%22%2C%22originalAmount%22%3A28000%2C%22payAmount%22%3A28000%2C%22productId%22%3A205091%2C%22productUrl%22%3A%22https%3A%2F%2Fshow.bilibili.com%2Fplatform%2Fdetail.html%3Fid%3D27032%22%2C%22returnUrl%22%3A%22https%3A%2F%2Fshow.bilibili.com%2Fm%2Fplatform%2ForderDetail.html%3Forder_id%3D4008483054601999%22%2C%22serviceType%22%3A0%2C%22showContent%22%3A%22%E7%A5%A8%E5%8A%A1_%E5%A4%A9%E6%B4%A5%C2%B7%E5%B9%BB%E5%A5%8F%E5%8D%8E%E7%AB%A0%20%E5%8D%8E%E5%BD%A9%E7%9A%84%E6%B0%91%E6%97%8F%E9%9F%B3%E4%B9%90%E4%BC%9A_2020-06-08%2015%3A13%3A44_280%22%2C%22showTitle%22%3A%22bilibili%E7%A5%A8%E5%8A%A1%22%2C%22signType%22%3A%22MD5%22%2C%22timestamp%22%3A%221591600761725%22%2C%22traceId%22%3A3620566671%2C%22version%22%3A%221.0%22%2C%22sign%22%3A%223f4b6d504de54d39e40a1db7355123fa%22%7D
```



其他付款方式

京东白条，paypal, 银联，银行卡，信用卡

```
创建一个表单form，然后提交到一个统一的中转页(/cashier/redirect.aspx)，自动重定向

度小满钱包提供各大银行卡支付功能
```



### mc端

微信

https://pay.weixin.qq.com/static/product/product_intro.shtml?name=qrcode

h5支付（非微信浏览器）

H5支付要求商户在统一下单接口中上传用户真实ip地址

https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_2

```
weixin://wap/pay?appid%3Dwxd6841de60b02faef%26noncestr%3D095525b24fc94111a3663068c8dc8a90%26package%3DWAP%26prepayid%3Dwx091027118037832f961440d31092022500%26sign%3D2CF5A14607C6AAEDE382758CA87B973F%26timestamp%3D1591669631

// window.location.href 即可唤起微信

// 不过有时会被拦截，最好是用中转页唤起
// 中转页需要有refer头，不能直接用浏览器访问
// 中转页5s后自动返回redirect_url
// redirect_url需要询问用户是否完成

https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx0910361274191702bc95d3bc1642468500&package=3000135036&redirect_url=https%3A%2F%2Fpay.bilibili.com%2Fpayplatform-h5%2Fcashierdesk.html%3Ffrom%3Dh5wechatpay
```





Jsapi (微信浏览器)

https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1

需要获取openid(通过cookie，网校和cc还是不同的公众号)

```
function onBridgeReady(){
   WeixinJSBridge.invoke(
      'getBrandWCPayRequest', {
         "appId":"wx2421b1c4370ec43b",     //公众号名称，由商户传入     
         "timeStamp":"1395712654",         //时间戳，自1970年以来的秒数     
         "nonceStr":"e61463f8efa94090b1f366cccfbbb444", //随机串     
         "package":"prepay_id=u802345jgfjsdfgsdg888",     
         "signType":"MD5",         //微信签名方式：     
         "paySign":"70EA570631E4BB79628FBCA90534C63FF7FADD89" //微信签名 
      },
      function(res){
      if(res.err_msg == "get_brand_wcpay_request:ok" ){
      // 使用以上方式判断前端返回,微信团队郑重提示：
            //res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
      } 
   }); 
}
```

小程序类似



支付宝

支付宝中转页

![image-20200609141850481](/Users/hj/Library/Application Support/typora-user-images/image-20200609141850481.png)

```
https://mapi.alipay.com/gateway.do?_input_charset=UTF-8&app_pay=Y&body=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&enable_paymethod=balance%2CmoneyFund%2Ccoupon%2CcreditCard%2CcreditCardExpress%2CcreditCardCartoon%2CdebitCardExpress%2Cmcard%2Cpcard%2Cpromotion%2Cpcredit&it_b_pay=4055m&notify_url=https%3A%2F%2Fpaynotice.hujiang.com%2Fv1%2Fnotify%2Fali%2Fpay%2Fwap&out_trade_no=20200609141651336792&partner=2088521191999411&payment_type=1&return_url=https%3A%2F%2Fpay.hujiang.com%2Fmobile%2Fsuccess%2F21031001000020200609095200332598&seller_id=2088521191999411&service=alipay.wap.create.direct.pay.by.user&sign=dd811baa49ba0a21ac789e7a04e49f36&sign_type=MD5&subject=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&total_fee=1299.00

// 重定向
https://mclient.alipay.com/home/exterfaceAssign.htm?enable_paymethod=balance%2CmoneyFund%2Ccoupon%2CcreditCard%2CcreditCardExpress%2CcreditCardCartoon%2CdebitCardExpress%2Cmcard%2Cpcard%2Cpromotion%2Cpcredit&_input_charset=UTF-8&subject=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&sign=dd811baa49ba0a21ac789e7a04e49f36&it_b_pay=4055m&body=%E3%80%90%E6%B2%AA%E6%B1%9F%E8%AE%A2%E5%8D%95%E3%80%91%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%90%E4%B8%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%87%AA%E5%B7%B1&notify_url=https%3A%2F%2Fpaynotice.hujiang.com%2Fv1%2Fnotify%2Fali%2Fpay%2Fwap&alipay_exterface_invoke_assign_model=cashier&alipay_exterface_invoke_assign_target=mapi_direct_trade.htm&payment_type=1&out_trade_no=20200609141651336792&partner=2088521191999411&alipay_exterface_invoke_assign_sign=_z_xu7lf_t_a_c_bhm_fnsn_b_fo_jvr_n_ac_a5_mh_hw5nv_j_c_x_t_b03sw421_w1t%2F_tr1_a%3D%3D&service=alipay.wap.create.direct.pay.by.user&total_fee=1299.00&app_pay=Y&return_url=https%3A%2F%2Fpay.hujiang.com%2Fmobile%2Fsuccess%2F21031001000020200609095200332598&sign_type=MD5&seller_id=2088521191999411&alipay_exterface_invoke_assign_client_ip=218.82.138.105
```



```
https://mclient.alipay.com/home/exterfaceAssign.htm?_input_charset=UTF-8&subject=bilibili%E7%A5%A8%E5%8A%A1&sign=7bc9d30a684fc9492d300c474dadb584&it_b_pay=10m&notify_url=https%3A%2F%2Fpay.bilibili.com%2Fpayplatform%2Fnotify%2FalipayNotify&body=%E7%A5%A8%E5%8A%A1_%E4%B8%8A%E6%B5%B7%C2%B7%E7%AC%AC%E5%85%AD%E5%B1%8AFXACG%E5%8A%A8%E6%BC%AB%E5%B1%95_2020-06-09+14%3A22%3A30_35&alipay_exterface_invoke_assign_model=cashier&alipay_exterface_invoke_assign_target=mapi_direct_trade.htm&payment_type=1&out_trade_no=3259386852700065792&partner=2088031696413665&alipay_exterface_invoke_assign_sign=_b%2B_c_x_x0_oj%2F_w_ew%2Flti_x2y%2B9_cr%2B11_fak1_xt1au4_g_s_f34_lvgjz_nl_x_a0m5_a%3D%3D&service=alipay.wap.create.direct.pay.by.user&total_fee=35.00&app_pay=Y&return_url=https%3A%2F%2Fpay.bilibili.com%2Fpayplatform%2Freturn%2Fsuccess%2F3259386852700065792&goods_type=1&sign_type=MD5&show_url=https%3A%2F%2Fshow.bilibili.com%2Fm%2Fplatform%2Fdetail.html%3Fid%3D22165&seller_id=2088031696413665&alipay_exterface_invoke_assign_client_ip=218.82.143.186
```

https://myjsapi.alipay.com/jsapi/index.html



https://www.jianshu.com/p/155757d2b9eb

### app端

